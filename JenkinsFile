pipeline {
    agent {
        docker {
            image 'budtmo/docker-android-x86-11.0'
            args '--privileged -v /dev/bus/usb:/dev/bus/usb'
        }
    }
    stages {
        stage('Check SDK') {
      steps {
        sh 'adb --version'
        sh 'emulator -list-avds || true'
      }
    }
    stage('Start Emulator') {
      steps {
        sh '''
          emulator -avd Pixel_3 -no-snapshot -noaudio -no-window &
          adb wait-for-device
        '''
      }
    }

        stage('Run_Test') {
            steps {
                echo "Ex√©cution des tests Maven..."
                sh 'mvn clean test'
            }
        }
    }

    post {
        always {
            echo "Publication des rapports..."
        }
    }
}
